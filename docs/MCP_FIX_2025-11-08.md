# FaulknerDB MCP Server Fix - 2025-11-08

## Issue
FaulknerDB MCP server was failing to start in Claude Desktop with the error:
```
TypeError: 'function' object is not subscriptable
```

## Root Cause
Version incompatibility between MCP SDK v1.21.0 and anyio v3.7.1.

The MCP SDK v1.21.0 uses Python 3.9+ generic type syntax that requires anyio 4.x:
```python
anyio.create_memory_object_stream[ServerRequestResponder](0)
```

This syntax is not supported in anyio 3.7.1.

## Fix Applied

### 1. Upgraded anyio
```bash
pip install --upgrade 'anyio>=4.0.0'
```

**Result**: anyio upgraded from 3.7.1 → 4.11.0

### 2. Updated requirements.txt
Added version constraints to prevent future issues:
```
mcp>=1.21.0,<2.0.0
anyio>=4.0.0,<5.0.0
```

### 3. Verification
- ✅ anyio version confirmed: 4.11.0
- ✅ MCP server starts without errors (tested with timeout - waits for stdin as expected)
- ✅ No TypeError in session.py

## Next Steps for User

**To complete the fix, restart Claude Desktop:**

1. Completely quit Claude Desktop (Right-click icon → Quit)
2. Wait 5 seconds
3. Reopen Claude Desktop
4. The faulkner-db MCP server should now load successfully

**Verify in Claude Desktop:**
- Check that all 7 FaulknerDB tools are available
- Test a simple query: "Use query_decisions to search for test"

## Tools Available After Fix

1. `add_decision` - Record architectural decisions
2. `query_decisions` - Hybrid search (graph + vector + reranking)
3. `add_pattern` - Document design patterns
4. `add_failure` - Track system failures
5. `find_related` - Discover relationships
6. `detect_gaps` - Identify knowledge holes
7. `get_timeline` - Temporal analysis

## Technical Details

**Environment:**
- Python: 3.12.3
- MCP SDK: 1.21.0
- anyio: 4.11.0 (upgraded from 3.7.1)
- OS: WSL2 Ubuntu

**Error Location:**
`/home/platano/projects/faulkner-db/venv/lib/python3.12/site-packages/mcp/server/session.py:96`

**Fix Location:**
`/home/platano/projects/faulkner-db/requirements.txt`

---

**Fixed by**: Claude Code
**Date**: 2025-11-08
**Status**: Verified Working
